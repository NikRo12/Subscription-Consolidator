@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

LAYOUT_WITH_LEGEND()

title Схема архитектуры Консолидатора Подписок

Person(user, "Пользователь", "Владелец подписок")

Container_Boundary(api_app, "Система Консолидации") {

    Component(web_app, "Frontend", "TypeScript React / Vue / что там нужно", "Интерфейс пользователя, отображение графиков и списка подписок")

    Component(back1, "Back1 (Main API)", "Go", "Бизнес-логика, управление пользователями, API для фронтенда")
    
    Component(back2, "Back2 (Email Parser)", "Go", "Интеграция с Google API, обработка писем, извлечение данных")

    ContainerDb(db_main, "PostgreSQL", "Relational DB", "Хранит данные юзеров, подписки, историю транзакций")
    
    ContainerDb(redis_queue, "Redis", "Message Broker / Queue", "Очереди задач (Jobs) и результатов (Results)")
}
System_Ext(google_api, "Google Gmail API", "Внешний сервис для доступа к почте")

' Связи
Rel(user, web_app, "Использует", "HTTPS")
Rel(web_app, back1, "Запросы данных / Команды", "JSON/HTTPS")

Rel(back1, db_main, "CRUD операции", "SQL")
Rel(back1, redis_queue, "Создает задачи на парсинг", "BullMQ / Celery")

Rel(redis_queue, back2, "Забирает задачи", "Job Data")
Rel(back2, google_api, "Читает письма", "OAuth2 / REST")
Rel(back2, redis_queue, "Кладет результаты парсинга", "Result Data")

Rel(redis_queue, back1, "Слушает результаты", "Events")
@enduml